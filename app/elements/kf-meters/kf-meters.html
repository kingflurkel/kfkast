<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="kf-meters">
  <style>
    :host {
      display: block;
    }
  </style>
  <template>
    <iron-ajax
       auto
       url="https://data.sparkfun.com/output/DJLnMNw2mJcjqEZMn5wq.json"
       handle-as="json"
       on-response="handleResponse"
       response="{{data}}"></iron-ajax>

<template is="dom-if" if="{{chartready}}">
    <chart-line id="chart" data="[[linedata"></chart-line>
</template>

  </template>
</dom-module>
<script>


(function() {

  //https://data.sparkfun.com/output/DJLnMNw2mJcjqEZMn5wq.json

  Polymer({
    is: 'kf-meters',

    properties: {
      foo: {
        type: String,
        value: 'bar',
        notify: true
      },

      chartready: {
        type: Boolean,
        value: false
      },

      linedata: {
        type: Object,
        value: {
          labels: [],
          datasets: [{
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: []
          }]
        },
        observer: "_linedata"
      }

    },

    handleResponse: function(e){
      var response = e.detail.response;
      var linedata = this.linedata;
      //for (var i = response.length - 1; i >= 0; i--) {
      for (var i = 10 - 1; i >= 0; i--) {
        console.log(response[i]);
        linedata.labels.push(response[i].timestamp);
        linedata.datasets[0].data.push(Number(response[i].light));
      };
      this.linedata = linedata;
      console.log(this.linedata);
      this.chartready = true;
      //this.$.chart._chartChanged();
    },

    _linedata: function(){
      console.log(this.linedata);
    }
  });
})();
</script>
